import { GetServerSideProps } from "next";
import type { NextPage } from "next";
import Head from "next/head";
import { prisma } from "../db/client";
import { trpc } from "../utils/trpc";

const Index: NextPage = (props: any) => {
  const { data, isLoading } = trpc.useQuery(["getAllFilms"]);

  console.log(data);

  if (isLoading || !data) return <div>Loading...</div>;
  return (
    <div className="">
      <Head>
        <title>Frumatic Case App | Janberk Ucar</title>
        <meta name="description" content="Generated by create next app" />
      </Head>
      <main className="flex flex-col">
        <h1 className="self-center text-3xl font-bold ">Frumatic Case App </h1>
        <div className="flex flex-col w-100 overflow-hidden items-center">
          {/* <h1>{data?.greeting}</h1> */}
          <code>{props.films}</code>
          {data?.films.map((film) => (
            <div key={film?.id} className="w-1/2 flex m-4">
              <a href="">
                <h3>Title: {film?.title}</h3>
                <h3>Overview: {film?.overview}</h3>

                <h3>Popularity: {film?.popularity}</h3>
                <h3>Vote Average: {film?.vote_average}</h3>
                <h3>Vote Count: {film?.vote_count}</h3>
                <h3>Budget: {film?.budget}</h3>

                <h3>Release Date: {film?.release_date.toLocaleDateString()}</h3>
                <h3>Created At: {film?.createdAt.toLocaleDateString()}</h3>
              </a>
            </div>
          ))}
          <br />
          <code>{props.account}</code>
          {/* <code>{account}</code> */}
          <br />
          <code>{props.genres}</code>
          {/* <code>{genres}</code> */}
        </div>
      </main>
      <footer className=""></footer>
    </div>
  );
};

export const getServerSideProps: GetServerSideProps = async (ctx) => {
  const filmData = await prisma.film.findMany();
  const accountData = await prisma.account.findMany();
  const genreData = await prisma.genre.findMany();

  return {
    props: {
      films: JSON.stringify(filmData),
      account: JSON.stringify(accountData),
      genres: JSON.stringify(genreData),
    },
  };
};

export default Index;
